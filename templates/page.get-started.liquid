<style>
.ProductItem__PriceList {
  opacity: 1 !important;
}

.js .ProductList--grid .ProductItem {
      visibility: visible !important;
  }
  .custom-button-container{
    margin-top: 50px;
  }
  
/*
@media screen and (max-width: 576px) {
  #collection-filter-drawer {
    position:absolute !important;
    top: 32% !important;
    height: 550px;
    /*max-height: 705px !important;

  }
  .PageOverlay {
    height:auto !important;
  }
}*/
/* CAROUSAL flickity.css */

.carousel-cell {
  width: 100%;
  margin-right: 10px;
  border-radius: 5px;
}
.get-started-carousel .grid-cell-padding{
    padding-left: 0;
}
</style>

<div class="page-width">
  <div class="grid">
      <div class="grid__item medium-up--five-sixths medium-up--push-one-twelfth">
          <!-- Flickity HTML init -->
         
          {% section 'back-carousal' %}
          <div class="carousel get-started-carousel">
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">
                {% section 'image-overlay' %}
                {% section 'product-kit-collection' %}
                
            </div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">{% section 'step-one' %}</div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">
                {% section 'step-two' %}
                {% section 'subscription-product-kit' %}
                <div class="custom-button-container"> 
                  {% section 'custom-button' %}
                </div>
                {% section 'product-subscription-collection-template' %} 
              </div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">{% section 'step-three' %}</div>

          </div>
          
      </div>
  </div>
  {%section 'modal' %}
  
</div>
<script>
  // Cookie Code
function checkCookie(cookieName) {
    var cookie = getCookie(cookieName);
    if (cookie == "") {
        return false;
    } else {
        return true;
    }
}

function setCookie(cookieName, cvalue) {
    var cookieContent = cookieName + "=" + JSON.stringify(cvalue) ; 
    document.cookie = cookieContent;    
}
  
function getCookie(cookieName) {
    var name = cookieName + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
}

function deleteCookie(cname) {
    var d = new Date(); //Create an date object
    d.setTime(d.getTime() - (1000*60*60*24)); //Set the time to the past. 1000 milliseonds = 1 second
    var expires = "expires=" + d.toGMTString(); //Compose the expirartion date
    window.document.cookie = cname+"="+"; "+expires;//Set the cookie with name and the expiration date
}

  $(function() {
    // Initially All Products Sections should be invisible - Only Clicking Btn will show this section.
    $("#shopify-section-product-subscription-collection-template").css('display', 'none');
      var cName = "testgmcscookie";
      var maxSlides = 3;
      var userSelectedSlide = 0;
      var currentSlideSelected = userSelectedSlide;
      var userOptions = {
          currentSlideSelected : userSelectedSlide,
          hygeineType : 0,
          addons:[],
      };
      var addonProduct = {
          name:'',
          id:'',
          quantity: '',
          addType: '' // Subscription or One Time
      };

      var isCookiePresent = checkCookie(cName);
      if(true == isCookiePresent) {
          // get user selection for ALL Steps
          userOptions = JSON.parse(getCookie(cName));
          userSelectedSlide = userOptions["currentSlideSelected"];
          hygeineType = userOptions["hygeineType"];
          if(hygeineType !== 0){
            // Mark user selected hygeine option
            $("input[name=step-one-hygeine]").val([hygeineType]);
          } else {
            $("#go-next-step").attr('disabled', 'disabled');  
          }
      } else {
          setCookie(cName, userOptions);
      }
      
      // Dont show Prev - Next on STEP 0 and STEP 3 i.e. Cart Page as we have everything to edit there.
      if(userSelectedSlide < 1 || userSelectedSlide > 3 ) {
          $("#go-previous-step").css ('display', 'none');
          $("#go-next-step").css ('display', 'none');          
      } else {
          $("#go-previous-step").css ('display', 'block');
          if(userSelectedSlide == 3) {
            $("#go-next-step").css ('display', 'none');      
          } else {
            $("#go-next-step").css ('display', 'block');  
          }
      }
      
      var $carousel = $('.get-started-carousel').flickity({
          'selectedAttraction': 0.01,
          'friction': 0.15,
          'prevNextButtons': false,
          'pageDots': false,
          'draggable': false,
          'fade': true,
          'adaptiveHeight': true,
          'resize': true,
          'accessibility': false
      });  

      // var html = $('#collection-filter-drawer').clone();
      // $("body").append(html)
      // $('#collection-filter-drawer').remove();

        // Go to user selected Slide - without animation
      $carousel.flickity( 'select', userSelectedSlide, false, true );

      $(".previous").on('click', function() {
        // Hide the Filters - They show up on Step 1 in some scenarios.
        $('#collection-filter-drawer').css('display', 'none');
        userOptions = JSON.parse(getCookie(cName));
        userSelectedSlide = userOptions["currentSlideSelected"];
        userSelectedSlide = userSelectedSlide - 1;
        userOptions["currentSlideSelected"] = userSelectedSlide;
        if(userSelectedSlide < 1 || userSelectedSlide > 3 ) {
            $("#go-previous-step").css ('display', 'none');
            $("#go-next-step").css ('display', 'none');          
        } else {
          if(userSelectedSlide == 3) {
            $("#go-next-step").css ('display', 'none');      
          } else {
            $("#go-next-step").css ('display', 'block');  
          }
        }
        setCookie(cName, userOptions);
        $carousel.flickity('previous', false, false);
      });

      $(".next").on('click', function() {
        userOptions = JSON.parse(getCookie(cName));
        userSelectedSlide = userOptions["currentSlideSelected"];
        var hygeineType = userOptions['hygeineType'];
        if(userSelectedSlide == 1 && hygeineType == 0) {
          // Do NOT proceed till user selects an option
          return false;
        }

        userSelectedSlide = userSelectedSlide + 1;
        userOptions["currentSlideSelected"] = userSelectedSlide;
        if(userSelectedSlide == 3) {
            $("#go-next-step").css ('display', 'none');      
          } else {
            $("#go-next-step").css ('display', 'block');  
          }
        setCookie(cName, userOptions);
        $carousel.flickity('next', false, false);
      });    

     $('input[name=step-one-hygeine]').on('change', function() {
          $("#go-next-step").removeAttr('disabled');
          userOptions = JSON.parse(getCookie(cName));
          userOptions['hygeineType'] = $(this).val();

          userSelectedSlide = userOptions["currentSlideSelected"];
          currentSlideSelected = userSelectedSlide + 1;
          userOptions["currentSlideSelected"] = currentSlideSelected;
          $carousel.flickity('next', false, false);
          setCookie(cName, userOptions);
      });

      $('#btn_email_to_shopifyregister_and_newsletter').click(function() {
          userOptions = JSON.parse(getCookie(cName));
          userSelectedSlide = userOptions["currentSlideSelected"];
          var hygeineType =  userOptions['hygeineType'];
          currentSlideSelected = userSelectedSlide + 1;
          if(currentSlideSelected == 1 && hygeineType == 0) {
            // Do NOT proceed till user selects an option
            $("#go-next-step").attr('disabled', 'disabled'); 
          }
          $carousel.flickity('next', false, false);
          userOptions["currentSlideSelected"] = currentSlideSelected;
          setCookie(cName, userOptions);
          $("#go-previous-step").css ('display', 'block');
          $("#go-next-step").css ('display', 'block');  
          return false;
      });

      // Step 2 - Toggle AllProducts Section
      $("#cta-custom-button").on('click', function(){
        $("#shopify-section-product-subscription-collection-template").toggle();
        $carousel.flickity('reloadCells');
        return false;
      });

      $('#skipStep2').click(function (){
        userOptions = JSON.parse(getCookie(cName));
        userSelectedSlide = userOptions["currentSlideSelected"];
        userSelectedSlide = userSelectedSlide + 1;

        userOptions["currentSlideSelected"] = userSelectedSlide;
        setCookie(cName, userOptions);
        $carousel.flickity('next', false, false);
        if(userSelectedSlide == 3) {
            $("#go-next-step").css ('display', 'none');      
          } else {
            $("#go-next-step").css ('display', 'block');  
          }
        return false;
      });

      $('#viewAllProd').on('click', function () {

      $.get('/collections/subscription-product?view=ajax', function (data) {

        $("#viewAllProductListing").html(data);
        //$('.js .ProductList--grid .ProductItem').css('visibility', 'visible');
        $carousel.flickity('reloadCells');

      });
    });

    // FILTER Container
    $('.CollectionToolbar__Item--filter').on('click', function(event){ 
      var cloneFilterElement = null;
     // if($('#shopify-section-product-subscription-collection-template #collection-filter-drawer').length > 0){
        cloneFilterElement = $('#shopify-section-product-subscription-collection-template #collection-filter-drawer').clone(true);
       // $('#shopify-section-product-subscription-collection-template #collection-filter-drawer').remove();
       // $('#shopify-section-back-carousal').before(cloneFilterElement);
     // } else {
        cloneFilterElement = $('#collection-filter-drawer');
    //  }
      
      $(cloneFilterElement).attr('aria-hidden', 'false');
    });
    
    // Tag CLICK Handler - To take TAG value and place in SECTION data-section-settings JSON Object.
   // $(document).on("click", '#collection-filter-drawer li button', function(e){debugger;
    $('#collection-filter-drawer li button').on("click", function(e){debugger;
      e.preventDefault();
      var selectedTag = $(e.target).attr('data-tag');
      var selectedTag1 = $(this).attr('data-tag');
      var jsonP = JSON.parse($('[data-section-id="product-subscription-collection-template"]').attr('data-section-settings'));
      console.log(selectedTag + " - " + selectedTag1);
      var arr = [];
      arr.push(selectedTag);
      jsonP.currentTags =  arr;
      $('[data-section-id="product-subscription-collection-template"]').attr('data-section-settings',JSON.stringify(jsonP));
      var originalTagBtn = $('#shopify-section-product-subscription-collection-template #collection-filter-drawer').find('button[data-tag="'+selectedTag+'"]');
      if($(originalTagBtn).length > 0){
        console.log('Gauri');
        //$(originalTagBtn).trigger('click');
        //return false;
      }
      /*$('#shopify-section-product-subscription-collection-template #collection-filter-drawer li').each(function( index ) {
        var tempBtn = $(this).find('button');
        if($(tempBtn).attr('data-tag') === selectedTag){
          // Trigger CLICK of the Original Tag.
         $(tempBtn).click();
         // break;
        }
      });*/
    });

    // Apply CSS Highlighted for a specific Tag.
    $('#collection-filter-drawer li').on('click', function(e){
      var tagBtn =  $(this).find('button');
      var tag = $(tagBtn).attr('data-tag');
      $('#collection-filter-drawer li').removeClass('is-selected');
      $('#collection-filter-drawer li button').removeClass('is-active');
    //  $('#shopify-section-product-subscription-collection-template #collection-filter-drawer li').find('button[data-tag="enjoyyourv"]').click();
     
    $('#shopify-section-product-subscription-collection-template #collection-filter-drawer li').each(function( index ) {
      var tempBtn = $(this).find('button');
      if($(tempBtn).attr('data-tag') === tag){
        // Add CSS Classes to it.
        $(this).addClass('is-selected');
        $(tempBtn).addClass('is-active');
      }
    });
    $(this).addClass('is-selected');
      $(this).find('button').addClass('is-active');
    });

    $(document).on("click", '[data-drawer-id="collection-filter-drawer"]:first', function(e){
      $('#collection-filter-drawer').attr('aria-hidden', 'true');
      return false;
    });

    $('[data-action="apply-tags"]:first').on('click', function(e){
      $('[data-action="apply-tags"]:last').click();
      $('[data-action="reset-tags"]').css('display', 'block'); // Show RESET after atleast 1 filter is applied.
      $('#collection-filter-drawer').attr('aria-hidden', 'true');
      return false;
    });

    $('[data-action="reset-tags"]:first').on('click', function(e){
      $('[data-action="reset-tags"]:last').click();
      $('[data-action="reset-tags"]').css('display', 'none');
      $('#collection-filter-drawer').attr('aria-hidden', 'true');
      return false;
    });

    // For MOBILE ONLY - Step 1 Info Display
    $('.info-icon').on('click', function(e) {
        var id = e.target.id;
        var descriptionDiv = id + '-description'
        if($('#' + descriptionDiv).is(":visible")) { 
          $('.info-icon-description').css('display','none');
        } else {
          $('.info-icon-description').css('display','none');
          $('#' + descriptionDiv ).css('display','block');
          $('#' + descriptionDiv ).css('text-align', 'center');
        }
        return false;
    });

  });
</script>