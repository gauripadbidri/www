<style>
/* CAROUSAL flickity.css */

.carousel-cell {
  width: 100%;
  margin-right: 10px;
  border-radius: 5px;
}
.get-started-carousel .grid-cell-padding{
    padding-left: 0;
}
</style>

<div class="page-width">
  <div class="grid">
      <div class="grid__item medium-up--five-sixths medium-up--push-one-twelfth">
          <!-- Flickity HTML init -->
          
          {% section 'back-carousal' %}
          <div class="carousel get-started-carousel">
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">
                {% section 'image-overlay' %}
                {% section 'product-kit-collection' %}
                
            </div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">{% section 'step-one' %}</div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">{% section 'step-two' %}</div>
              <div class="grid-cell-padding Grid__Cell 1/1--phone 1/1--tablet 1/1--lap-and-up">{% section 'step-three' %}</div>
          </div>
      </div>
  </div>
  {%section 'modal' %}
</div>
<script>
function checkCookie(cookieName) {
    var cookie = getCookie(cookieName);
    if (cookie == "") {
        return false;
    } else {
        return true;
    }
}

function setCookie(cookieName, cvalue) {
    var cookieContent = cookieName + "=" + JSON.stringify(cvalue) ; 
    document.cookie = cookieContent;    
}
  
function getCookie(cookieName) {
    var name = cookieName + "=";
    var ca = document.cookie.split(';');
    for(var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }
    }
    return "";
}

function deleteCookie(cname) {
    var d = new Date(); //Create an date object
    d.setTime(d.getTime() - (1000*60*60*24)); //Set the time to the past. 1000 milliseonds = 1 second
    var expires = "expires=" + d.toGMTString(); //Compose the expirartion date
    window.document.cookie = cname+"="+"; "+expires;//Set the cookie with name and the expiration date
 
}

  $(function() {

      var cName = "testgmcscookie";
      var maxSlides = 3;
      var userSelectedSlide = 0;
      var currentSlideSelected = userSelectedSlide;
      var userOptions = {
          currentSlideSelected : userSelectedSlide,
          hygeineType : 0,
          addons:[],
      };
      var addonProduct = {
          name:'',
          id:'',
          quantity: '',
          addType: '' // Subscription or One Time
      };

      var isCookiePresent = checkCookie(cName);
      alert(isCookiePresent);
      if(true == isCookiePresent) {
          // get Cookie Value
          userOptions = JSON.parse(getCookie(cName));
          userSelectedSlide = userOptions["currentSlideSelected"];
         // userSelectedSlide = userSelectedSlide + 1;
          hygeineType = userOptions["hygeineType"];
          if(hygeineType !== "0"){
            $("input[name=step-one-hygeine]").val([hygeineType]);
          }
      } else {
          setCookie(cName, userOptions);
      }
      var sliderIndex = userSelectedSlide; // It is always current Slide number - 1 -> just like array index
      // Dont show Prev - Next on STEP 0 and STEP 3 i.e. Cart Page as we have everything to edit there.
      if(userSelectedSlide <= 1 || userSelectedSlide >= 3){
          $("#go-previous-step").css ('display', 'none');
          $("#go-next-step").css ('display', 'none');
      }      

      var $carousel = $('.get-started-carousel').flickity({
          'prevNextButtons': false,
          'pageDots': false,
          'draggable': false,
          'fade': true,
          'adaptiveHeight': true
      });  
      alert(sliderIndex);
        // Go to user selected Slide
        $carousel.flickity( 'select', sliderIndex, false, false );

      $("#go-previous-step").on('click', function() {
        currentSlideSelected = currentSlideSelected - 1;
          if(currentSlideSelected <= 1 || currentSlideSelected >= 3){
              $("#go-previous-step").css ('display', 'none');
          } else {
            $("#go-previous-step").css ('display', 'block');
            $("#go-next-step").css ('display', 'block');
          }
          userOptions["currentSlideSelected"] = currentSlideSelected;
          setCookie(cName, userOptions);
          $carousel.flickity('previous', false, false);
      });

      $("#go-next-step").on('click', function() {
        currentSlideSelected = currentSlideSelected + 1;
          if(currentSlideSelected <= 1 || currentSlideSelected >= 3){
            if (currentSlideSelected == 3) {
                $("#go-previous-step").css ('display', 'block');                
            } else {
                $("#go-previous-step").css ('display', 'none');
            }            
            $("#go-next-step").css ('display', 'none');
          } else {
            $("#go-previous-step").css ('display', 'block');
            $("#go-next-step").css ('display', 'block');
          }
          userOptions["currentSlideSelected"] = currentSlideSelected;
          setCookie(cName, userOptions);
          $carousel.flickity('next', false, false);
      });    

     $('input[name=step-one-hygeine]').on('change', function() {debugger;
          userOptions = JSON.parse(getCookie(cName));
          userOptions['hygeineType'] = $(this).val();
          userSelectedSlide = userOptions["currentSlideSelected"];
          currentSlideSelected = currentSlideSelected + 1;
          alert(currentSlideSelected);
          userOptions["currentSlideSelected"] = currentSlideSelected;
          $carousel.flickity('next', false, false);
          $("#go-previous-step").css ('display', 'block');
          $("#go-next-step").css ('display', 'block');
          setCookie(cName, userOptions);
      });

      $('#btn_email_to_shopifyregister_and_newsletter').click(function() {
          currentSlideSelected = currentSlideSelected + 1;
          $carousel.flickity('next', false, false);
          userOptions["currentSlideSelected"] = currentSlideSelected;
          alert('Started Click - ' + currentSlideSelected);
          setCookie(cName, userOptions);
          return false;
      });

      $('#skipStep2').click(function (){
        currentSlideSelected = currentSlideSelected + 1;
        if(currentSlideSelected <= 1 || currentSlideSelected >= 3) {
            if (currentSlideSelected == 3){
            $("#go-previous-step").css ('display', 'block');            
        } else {
            $("#go-previous-step").css ('display', 'none');
        }
            $("#go-next-step").css ('display', 'none');
        } 
          userOptions["currentSlideSelected"] = currentSlideSelected;
          setCookie(cName, userOptions);
          $carousel.flickity('next', false, false);
          return false;
      });
  });
</script>
    